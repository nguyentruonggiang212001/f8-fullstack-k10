"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="cc0bd255-ee2b-5100-96b1-ba42943c9e8a")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5099],{24973:(e,t,l)=>{l.d(t,{Mf:()=>n,vR:()=>a,xR:()=>d});let a="tab_group--tabs--ChhR5",n="tab_group--tab--j43X-",d="tab_group--selectedTab--dwZ1b tab_group--tab--j43X-"},901765:(e,t,l)=>{l.d(t,{L:()=>n});var a=l(411855);function n(e,t,l){a.useEffect(()=>{let a=a=>{var n;let d=a.target;l&&!d.isConnected||(null==(n=e.current)?void 0:n.contains(d))||t()};return document.addEventListener("click",a),()=>{document.removeEventListener("click",a)}})}},706638:(e,t,l)=>{l.d(t,{P:()=>K,v:()=>O});var a=l(411855),n=l(188507),d=l(539321);if(443==l.j)var o=l(395096);var s=l(776250),r=l(358145),i=l(395900),c=l(268537),u=l(493323),m=l(135876),f=l(827586),p=l(32863),g=l(574176),E=l(939863),v=l(738269),b=l(852800),h=l(15859),C=l(318812),y=l(29680),k=l(463592),N=l(103271),I=l(720488),_=l(406158),P=l(780634);if(443==l.j)var x=l(949207);if(443==l.j)var M=l(156238);if(443==l.j)var S=l(432023);var O=(e=>(e.LOADED="post-to-feed-view-loaded",e.SELECT_NODE="post-to-feed-select-node",e))(O||{});function F(e){return a.createElement("div",{className:null!==e.isSelectedIdx?P.El:P.Vs,onClick:e.onClick,role:"button",tabIndex:0,ref:t=>{t&&e.observe(t)},"data-observer-guid":e.node.guid},a.createElement("div",{className:P.h3,style:{backgroundColor:e.backgroundColor}},a.createElement(m.x,{isLoading:!e.thumbnailUrl},()=>a.createElement("img",{className:P.xn,src:e.thumbnailUrl,alt:"",draggable:!1}))),a.createElement("div",{className:P.JO},a.createElement("div",{className:P.qp},e.node.name)),null!==e.isSelectedIdx&&1!==e.totalNumSelected&&a.createElement("div",{className:P.Jx},e.isSelectedIdx+1))}function T(e){let{toggleSelectNode:t}=e,l=(e.pageNode&&(0,d.colorToHex)(e.pageNode.backgroundColor))??"",[n,o]=a.useState(!1),s=a.useCallback(a=>{t(a,{pageId:e.pageNode.guid,pageBackgroundColor:l})},[t,e.pageNode.guid,l]);return a.createElement("div",{className:P.RW},e.showCollapsibleHeader&&a.createElement("div",{className:P.Vr,onClick:()=>o(e=>!e),role:"button",tabIndex:0},n?a.createElement(g.B,{svg:S.A,className:P.Rq}):a.createElement(g.B,{svg:x.A,className:P.Rq}),e.pageNode.name,"\xa0",a.createElement("span",{className:P.Du},"\xb7 ",e.nodes.length)),!n&&a.createElement("div",{className:P.Mc},e.nodes.map(t=>{var n,d,o;let r=(null==(n=e.selectedNodeGuids)?void 0:n.indexOf(t.guid))??null;return a.createElement(F,{key:`node-${t.guid}`,node:t,thumbnailUrl:(null==(d=e.thumbnailByGuid[t.guid])?void 0:d.url)??"",backgroundColor:l,isSelectedIdx:-1===r?null:r,onClick:()=>s(t.guid),totalNumSelected:(null==(o=e.selectedNodeGuids)?void 0:o.length)??null,observe:e.observe})})))}let w="feed-post-page-selector-menu";function K(){let e=a.useCallback((e,t)=>{let l=window.parent;window.self.origin===l.origin&&l&&l.postMessage({type:e,data:t})},[]),t=a.useRef(new i.jk("feed_post_to_file_load",{}));a.useEffect(()=>{t.current.start()},[]);let l=(0,y.aV)(),d=(0,y.eY)(),m=(0,n.d4)(e=>{var t;return null==(t=e.openFile)?void 0:t.key});a.useEffect(()=>{if(!l){t.current.stop();let l=t.current.getElapsedTime();(0,s.sx)("team_feed.post_from_file.file_load",{elapsedMs:l,fileKey:m}),e("post-to-feed-view-loaded",!0)}},[l,e,m]);let x=(0,n.d4)(e=>e.mirror.appModel.pagesList),S=a.useMemo(()=>x.reduce((e,t)=>({...e,[t.nodeId]:d.get(t.nodeId)}),{}),[x,d]),O=(0,n.wA)(),F=a.useMemo(()=>Object.values(S).flatMap(e=>e?e.uiOrderedChildren.map(t=>{let l=d.get(t);return l&&("FRAME"===l.type||"SECTION"===l.type)?{...l,pageId:e.guid,name:null==l?void 0:l.name}:null}).filter(e=>e):[]).filter(e=>null!==e),[S,d]),K=a.useMemo(()=>{let e={};for(let t of F)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[F]),D=a.useMemo(()=>new k.Ef(F,{keys:["name"]}),[F]),[R,j]=a.useState(""),[A,U]=a.useState(null),[L]=(0,o.A)(R,200),B=a.useCallback(e=>{U(D.search(e))},[D]),Y=a.useMemo(()=>{if(null===A)return null;let e={};for(let t of A)e[t.pageId]?e[t.pageId].push(t):e[t.pageId]=[t];return e},[A]);a.useEffect(()=>{""!==L&&B(L)},[L,B]);let Z=(0,C.Um)(),q=a.useRef(null),[z,G]=a.useState(null);a.useEffect(()=>{if(z||!d||!K||0===Object.keys(K).length)return;let e=d.get(Object.keys(K)[0]);e&&G(e)},[z,K,d]);let[H,J]=a.useState({}),[V,W]=a.useState([]),$=(0,r.ZC)(V),X=a.useRef(null),[Q,ee]=a.useState([]),et=a.useCallback(e=>{let t=[];e.forEach(e=>{var l;if(e.isIntersecting&&e.target instanceof HTMLElement){let a=null==(l=e.target.dataset)?void 0:l.observerGuid;a&&t.push(a)}}),ee(t)},[]),el=a.useMemo(()=>new IntersectionObserver(et,{threshold:[.25]}),[et]),ea=a.useCallback(e=>{el&&el.observe(e)},[el]),[en,ed]=a.useState({});a.useEffect(()=>{if(0===Q.length)return;let e=Q.filter(e=>!en[e]);0!==e.length&&(0,h.Jr)().loadAllImagesUnder(e,b.MoD.NON_ANIMATED_ONLY,"feed.postFromFile").then(()=>{e.forEach(e=>{setTimeout(()=>{ed(t=>{if(t[e])return t;let l=(0,_.BO)(e);return{...t,[e]:{url:URL.createObjectURL(new Blob([l])),data:l}}})},0)})})},[Q,en]),a.useEffect(()=>{V!==$&&e("post-to-feed-select-node",V.map(e=>({guid:e,thumbnail:en[e].data,backgroundColor:H[e]})))},[$,V,e,en,H]);let eo=a.useCallback((e,t)=>{en[e]&&(J(l=>t.pageBackgroundColor?{...l,[e]:t.pageBackgroundColor}:l),W(t=>t.includes(e)?t.filter(t=>e!==t):t.length>=N.e3?t:[...t,e]))},[en]);return K&&0===Object.keys(K).length?a.createElement("div",{className:P.se},(0,E.t)("fig_feed.no_top_level_nodes")):z?a.createElement("div",{className:P.kL},a.createElement("div",{className:P.Y},a.createElement(p.IW,{query:R,className:P.ON,onChange:j,clearSearch:()=>{j(""),U(null)},focusOnMount:!1,iconClassName:P.qc,placeholder:(0,E.t)("fig_feed.search_frames")}),""===R&&a.createElement(a.Fragment,null,a.createElement("div",{role:"button",ref:q,onClick:()=>{(null==Z?void 0:Z.type)===w?O(v.oB()):O(v.j7({type:w}))},tabIndex:0,className:P.YZ},a.createElement("div",null,z.name),a.createElement(g.B,{svg:M.A,width:"8px",autosize:!0})),q.current&&(null==Z?void 0:Z.type)===w&&a.createElement(I.Cf,{showPoint:!1,targetRect:q.current.getBoundingClientRect(),propagateCloseClick:!0},Object.keys(K).map(e=>a.createElement(c.MM,{key:e,onClick:()=>G(S[e]),checked:z.guid===e},S[e].name))))),a.createElement(f.P,{hideScrollbar:!0,className:P.jG,innerClassName:P.hu,scrollContainerRef:X},""===R&&a.createElement(T,{pageNode:z,nodes:K[z.guid]||[],thumbnailByGuid:en,selectedNodeGuids:V,toggleSelectNode:eo,observe:ea}),""!==R&&(null===Y?a.createElement("div",{className:P.Do},a.createElement(u.kt,{size:"large"})):Object.entries(Y).length>0?Object.entries(Y).map(([e,t])=>a.createElement(T,{key:e,pageNode:S[e],nodes:t,thumbnailByGuid:en,selectedNodeGuids:V,toggleSelectNode:eo,showCollapsibleHeader:!0,observe:ea})):a.createElement("div",{className:P.Lp},a.createElement("div",null,(0,E.tx)("fig_feed.no_frames_matching",{searchQuery:a.createElement(a.Fragment,null,a.createElement("span",{className:P.ZF},R))})))))):null}},975723:(e,t,l)=>{l.r(t),l.d(t,{EditFeedPostModal:()=>Z});var a=l(411855),n=l(188507),d=l(629019),o=l.n(d),s=l(776250),r=l(609494),i=l(966712),c=l(498750),u=l(915440),m=l(27087),f=l(448169),p=l(946689),g=l(493323),E=l(881388),v=l(939863),b=l(392592),h=l(507877),C=l(662275),y=l(654034),k=l(694687),N=l(860178),I=l(279453),_=l(204279),P=l(531827),x=l(28588),M=l(103271),S=l(49218),O=l(588282),F=l(126674),T=l(679736),w=l(406158),K=l(301799),D=l(583630),R=l(660040),j=l(563288),A=l(160156),U=l(118143),L=l(782680),B=l(988898),Y=l(470400);function Z(e){let t=(0,n.wA)(),l=a.useCallback(()=>{t(C.Ce())},[t]),d=(0,v.tx)("fig_feed.edit_post"),o=e.feedPostUuid;!o&&e.feedPostThreadId&&(o=(0,O.gk)(e.feedPostThreadId));let s=(0,u.Rs)(I.FHz,{publicUuid:o},{enabled:!e.preloadedFeedPost&&!!o}),r=a.useMemo(()=>e.preloadedFeedPost?e.preloadedFeedPost:"loaded"===s.status?s.data.feedPost:null,[e.preloadedFeedPost,s]);return a.createElement(S.hZ,{header:a.createElement("div",{className:Y.Hc},d),onClose:l,maxWidth:S.Fo,disableFixedTop:!0,closeOnEsc:!0},r?a.createElement(q,{onSubmitSuccess:e.onSubmitSuccess,entryPoint:e.entryPoint,lockedFileKey:e.lockedFileKey,feedPost:r}):a.createElement("div",{className:Y._5},a.createElement(g.kt,{size:"large"})))}function q(e){var t;let l=(0,n.wA)(),d=(0,k.sZ)(),u=(0,N.iZ)(),[I,S]=a.useState(!0),[O,Z]=a.useState(!1),[q,z]=a.useState(!1),G=(0,j.e3)(e.feedPost),H=e.feedPost.publicUuid,J=a.useMemo(()=>e.feedPost.content.map(e=>JSON.parse(e)),[e.feedPost]),[V,W]=a.useState(J.reduce((e,t)=>{if(t.type!==M.cM.NODE)return e;e.fileKey=t.fileKey;let l=t.nodeId;return e.nodeIds.push(l),e},{fileKey:e.feedPost.fileKey||"",nodeIds:[]})),$=a.useMemo(()=>{let e=J.find(e=>e.type===M.cM.PROTOTYPE);return e?{fileKey:e.fileKey,pageId:e.pageId,startingNodeId:e.startingNodeId}:null},[J]),[X,Q]=a.useState(0),ee=a.useCallback(()=>{l(C.Ce())},[l]),et=a.useCallback(()=>{l((0,C.to)({type:L.h,data:{onConfirm:ee},showModalsBeneath:!0}))},[l,ee]),el=e.lockedFileKey||(null==V?void 0:V.fileKey)||(null==$?void 0:$.fileKey);a.useEffect(()=>{let t={entryPoint:e.entryPoint};el&&(t.fileKey=el),(0,s.sx)("Team Feed Edit Post Modal Opened",t)},[e.entryPoint,el]);let ea=a.useCallback((e,t,a)=>{if(t){l(C.Ce());return}let n={text:(0,v.t)("fig_feed.view_post"),action:()=>{l(h.V3({url:(0,F.Kc)(d.id,{uuid:e})}))}};l(b.F.enqueue({message:(0,v.t)("fig_feed.post_edited"),button:a?n:void 0})),l(C.Ce())},[l,d]),[en,ed]=a.useState(J.map(e=>{let t=(0,w.EU)(e),l=(0,M.aT)(e)&&!!e.hasPreviousEditPreview,a={...e,copiedToS3:e.type===M.cM.NODE||e.type===M.cM.PROTOTYPE,shouldBlockEditPreview:l&&!t};return{displayContentItem:a,processedContentItem:Promise.resolve(a)}})),eo=a.useMemo(()=>new Set(en.map(e=>e.displayContentItem.type===M.cM.NODE?e.displayContentItem.nodeId:null).filter(e=>null!==e)),[en]);a.useEffect(()=>{(0,K.sr)(V,eo,ed,null==d?void 0:d.id)},[V,eo,ed,null==d?void 0:d.id]);let es=a.useCallback(e=>{let t=(0,A.K1)(en[X].displayContentItem);Q(e.findIndex(e=>(0,A.K1)(e)===t));let l=[];e.forEach(e=>{let t=(0,A.K1)(e),a=en.find(e=>(0,A.K1)(e.displayContentItem)===t);a?l.push(a):console.error("Expected to have a matchedPendingItem")}),ed(l)},[en,X]),er=a.useCallback(e=>{Q(en.findIndex(t=>(0,A.K1)(t.displayContentItem)===e))},[en]),{setContentPreview:ei,snapshotStates:ec}=(0,K.eh)(en,ed),{onSubmitSuccess:eu}=e,em=a.useCallback((t,a)=>{m.Ay.put(`/api/feed_posts/${H}`,t).then(t=>{ea(t.data.meta.public_uuid,a,e.entryPoint===T.M2.FILE),a&&l(b.F.enqueue({message:(0,v.t)("fig_feed.post_submission_pending")})),eu&&eu(a)}).catch(()=>{l(E.s.error((0,v.t)("fig_feed.error_on_feed_post_creation"))),S(!1)})},[l,ea,eu,H,e.entryPoint]),[ef,ep]=a.useState(e.feedPost.title||""),[eg,eE]=a.useState((0,y.o8)(e.feedPost.descriptionMeta)),ev=a.useMemo(()=>({library:new P.M8(d.id)}),[d]);a.useEffect(()=>{S(ef.trim().length>R.Y||(0,r._Z)(eg).length>R.e||0===en.length)},[ef,eg,en.length]);let eb=async t=>{if(!d||I)return;null==t||t.preventDefault(),S(!0);let a={description_meta:eg,org_id:d.id},n=(0,r._Z)(eg);a.content=await (0,w.pj)(l,en,el??"",ef),(0,s.sx)("team_feed_content_awaited",{payloadContent:JSON.stringify(a.content)},{logFromProber:!0});let o=a.content.some(e=>e.pending);ef?a.title=ef:a.title=n.length>0?n.slice(0,40)+"\u2026":(0,v.t)("fig_feed.untitled_post"),el&&(a.attached_file_key=el),em(a,o),(0,s.sx)("Team Feed Post Edited",{fileKey:el,entryPoint:e.entryPoint,text:n,numContentItems:a.content.length,contentItemTypes:a.content.map(e=>e.type)},{forwardToDatadog:!0})},eh=a.useCallback((e,t)=>{if(!d)return;let a=Array.from(e);if(0===a.length)return;let n=(0,_.KT)(a,en.length,M.e3,M.bB,e=>{l(b.F.enqueue({message:(0,U.getUploadErrorMessage)(e)}))},en.map(e=>e.fileIdentifier)).map(e=>{let t=(0,_.Fn)(e);if(x.xp.includes(e.type))return(0,w.zr)(t,e);if(x.VY.includes(e.type))return(0,w.X2)(t,H,d.id,e);throw Error("unexpected file type")}),o=void 0!==t?t:en.length;ed(e=>[...e.slice(0,o),...n,...e.slice(o)]),Q(o)},[l,d,H,en]),eC=a.useCallback((e,t)=>()=>{var l;let a=(null==(l=e.current)?void 0:l.files)||null;null!==a&&0!==a.length&&(eh(a,t),e.current&&(e.current.value=""))},[eh]),ey=a.useCallback(e=>{let t=Math.min(e,Math.max(0,en.length-2)),l=en[e];if((0,w.AK)(l),ed(t=>t.filter((t,l)=>l!==e)),l.displayContentItem.type===M.cM.NODE){let e=l.displayContentItem.nodeId;W(t=>{if(t){let l=t.nodeIds.filter(t=>t!==e),a=t.nodeThumbnails,n=a&&l.reduce((e,t)=>(e[t]=a[t],e),{});return{...t,nodeIds:l,nodeThumbnails:n}}return null})}Q(t)},[en]),ek=a.useCallback((e,t)=>{eh(e.files,t),z(!1)},[eh]),eN=a.useRef(null),eI=!!(null==(t=null==V?void 0:V.nodeIds)?void 0:t.length),{openPostFromFileModal:e_,attachedFileData:eP}=(0,K.Ld)({setLinkedFileNodeInfo:W,numUserContentItems:en.length,hasNodeContent:eI,parentModalRef:eN,attachedFileKey:el,lockedFileKey:e.lockedFileKey,currentOrgId:null==d?void 0:d.id}),ex=a.useCallback(()=>{let t=en.map(e=>e.displayContentItem);return a.createElement(f.Y,{className:o()(Y.xe,q&&Y.w8),isDragTarget:()=>!0,onTargetDragEnter:()=>z(!0),onTargetDragLeave:()=>z(!1),onTargetDrop:e=>ek(e)},a.createElement(A.Zo,{contentItems:t,staticContent:!0,scrollable:!1,deleteItemAtIdx:O?void 0:ey,pageBackgroundColor:e.feedPost.backgroundColor??void 0,onReorderCallback:O?void 0:es,shouldScrollToIndex:null,selectedIdx:X,setSelectedIdx:Q,onFileInputChange:eC,setSelectedContent:er,snapshotStates:ec,setContentPreview:ei,openPostFromFileModal:e_,attachedFile:eP,dragging:q,mode:"edit"}))},[e.feedPost,q,es,ey,O,en,ek,X,eC,er,ec,ei,e_,eP]),eM=a.useCallback(e=>{e.keyCode===c.Uz.ESCAPE&&ee()},[ee]);return d&&u&&(0,i.kc)().xr_debounce_threshold?a.createElement("div",{className:Y.RO,onKeyDown:eM,role:"textbox",tabIndex:0,ref:eN},a.createElement("div",{className:Y.q3},ex(),d&&u?a.createElement("div",{className:Y.DA},a.createElement(D.FeedPostUnifiedComposer,{user:u,currentOrgId:d.id,autofocus:!0,mentionables:ev,onSubmit:I?void 0:eb,submitOnEnter:!1,hideSubmitButton:!0,description:eg,updateDescription:eE,title:ef,updateTitle:ep,displayDecoratorsDownwards:!0,minimized:!1,readOnly:O,editableTypeaheadClass:B.up,openPostFromFileModal:()=>e_({skipFrameSelection:!eI}),fileData:eP,lockFileAddition:en.length>=M.e3,parentRef:eN,canUnlinkFile:!eI&&!e.lockedFileKey,unlinkFile:()=>W(null)})):null),a.createElement("div",{className:Y.CQ},a.createElement("div",{className:Y._f},a.createElement("div",{className:Y.oW},a.createElement("div",{className:Y.Ru},(0,v.tx)("fig_feed.post_to")),a.createElement("div",{className:Y.Ev},a.createElement("div",{className:Y.oj},a.createElement(j.lO,{containerInfo:G,withoutTooltip:!0}),a.createElement("div",{className:Y.JT},G.name))))),a.createElement("div",{className:Y.UD},a.createElement(p.nR,{onClick:e=>{e.stopPropagation(),et()}},(0,v.tx)("fig_feed.discard_edit")),a.createElement(p.$$,{onClick:e=>{if(!O)return Z(!0),eb(e).finally(()=>{Z(!1)})},disabled:I,dataTestId:"feed-post-post",className:O?Y.zb:Y.pb},O&&a.createElement("div",{className:Y.YI},a.createElement(g.kt,{shouldMatchTextColor:!0,size:"medium"})),O?(0,v.tx)("fig_feed.saving"):(0,v.tx)("general.save"))))):null}}}]);

//# debugId=cc0bd255-ee2b-5100-96b1-ba42943c9e8a

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/c664dfcf6205934b088b28970f01de03cc7cdc6e/team_feed-31e8355f6b6a6f08.min.js.map